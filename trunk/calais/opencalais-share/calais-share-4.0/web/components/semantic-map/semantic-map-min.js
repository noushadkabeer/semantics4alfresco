(function(){var Dom=YAHOO.util.Dom,Event=YAHOO.util.Event;var $html=Alfresco.util.encodeHTML,$combine=Alfresco.util.combinePaths;Alfresco.dashlet.SemanticMap=function SemanticMap_constructor(htmlId){return Alfresco.dashlet.SemanticMap.superclass.constructor.call(this,"Alfresco.dashlet.SemanticMap",htmlId);};YAHOO.extend(Alfresco.dashlet.SemanticMap,Alfresco.component.Base,{options:{componentId:"",title:"",},titleContainer:null,mapContainer:null,map:null,onReady:function SemanticMap_onReady(){this.titleContainer=Dom.get(this.id+"-title");this.mapContainer=Dom.get(this.id+"-map");Event.addListener(this.id+"-refresh","click",this.onRefresh,this,true);this.refreshTitle();this.refreshMap();},refreshMap:function SemanticMap_refreshMap(){this.initializeMap();this.refreshTags();},refreshTitle:function SemanticMap_refreshTitle(){if(this.options.title==""){this.options.title=this.msg("semantic-map.defaultTitle");}this.titleContainer.innerHTML=this.options.title;},initializeMap:function SemanticMap_initializeMap(){var myLatlng=new google.maps.LatLng(40.749444,-73.968056);var myOptions={zoom:3,center:myLatlng,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(this.mapContainer,myOptions);},refreshTags:function SemanticMap_refreshTags(){var getTagsUrl=Alfresco.constants.PROXY_URI+"/semantics/getSemanticTags?format=json";if((this.options.siteId!==null)&&(this.options.siteId.length>0)){getTagsUrl+="&site="+this.options.siteId;}else{getTagsUrl+="&site=*";}Alfresco.util.Ajax.jsonGet({url:getTagsUrl,successCallback:{fn:this.onTagsSuccess,scope:this},failureCallback:{fn:this.onTagsFailed,scope:this},scope:this,noReloadOnAuthFailure:true});},onTagsSuccess:function SemanticMap_onTagsSuccess(p_response){var maxItems=50;var tags=p_response.json.tags.slice(0,maxItems);var i;var tagsLength=tags.length;var latLong;for(i=0;i<tagsLength;i++){var tag=tags[i];if((tag.latitude!=="")&&(tag.longitude!=="")){var lat=new Number(tag.latitude);var lng=new Number(tag.longitude);latLong=new google.maps.LatLng(lat,lng);this.createMarker(map,latLong,tag.name);}}},onTagsFailed:function SemanticMap_onTagsFailed(){},createMarker:function SemanticMap_createMarker(map,latLong,tagName){var marker=new google.maps.Marker({position:latLong,map:map,title:tagName});var uri=this.getSearchUri(tagName);google.maps.event.addListener(marker,"click",function(){window.location=uri;});},getSearchUri:function SemanticMap_getSearchUri(tagname){var uri=Alfresco.constants.URL_PAGECONTEXT+"semantic-search?semanticTag=";uri+=encodeURIComponent(tagname);if((this.options.siteId!==null)&&(this.options.siteId.length>0)){uri+="&site="+this.options.siteId;}return uri;},onRefresh:function SemanticTagCloud_onRefresh(e){if(e){Event.preventDefault(e);}this.refreshMap();},});})();